# Exemple d'utilisation du workflow de d√©ploiement DEV avec version
# Ce workflow d√©ploie automatiquement sur le serveur DEV apr√®s merge dans develop

name: üöÄ D√©ploiement DEV

on:
  pull_request:
    branches: [ develop ]
    types: [ closed ]

permissions:
  contents: write  # n√©cessaire pour le miroir git
  pull-requests: write

concurrency:
  group: dev-deploy-${{ github.event.pull_request.head.ref }}
  cancel-in-progress: true

jobs:
  deploy-dev:
    name: üöÄ D√©ploiement DEV
    uses: LeZouzouEnWeb/workflows/.github/workflows/dev-deploy.yml@V1.0.4
    permissions:
        contents: write  # n√©cessaire pour le miroir git
        pull-requests: write
    secrets:
      # Secrets requis pour le d√©ploiement SSH
      REMOTE_CHEMIN: ${{ secrets.REMOTE_CHEMIN }}        # Chemin de base sur le serveur
      SFTP_HOST: ${{ secrets.SFTP_HOST }}                # Adresse du serveur
      SFTP_USER: ${{ secrets.SFTP_USER }}                # Utilisateur SSH
      SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}    # Cl√© priv√©e SSH
    with:
      # Variables pour construire le chemin distant
      ADRESSE_GLOBAL: ${{ vars.ADRESSE_GLOBAL }}         # Ex: www
      ADRESSE_LOCAL: ${{ vars.ADRESSE_LOCAL }}           # Ex: mon-site
      remote_env: dev
      PATH_ORDER: local-env
